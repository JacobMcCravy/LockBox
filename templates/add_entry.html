{% extends "base.html" %}

{% block title %}LockBox â€” Add Entry{% endblock %}

{% block content %}
<style>
  .entry-form-container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: calc(100vh - 5rem);
    padding: 2rem;
    margin-top: 3rem;
  }
  
  .entry-form-card {
    background: var(--color-card-bg);
    border-radius: 1rem;
    box-shadow: 0 15px 45px rgba(0,0,0,0.5);
    width: 100%;
    max-width: 600px;
    overflow: hidden;
  }
  
  .form-header {
    background: rgba(0, 0, 0, 0.2);
    padding: 2rem;
    text-align: center;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }
  
  .form-title {
    font-size: 1.75rem;
    font-weight: 600;
    color: var(--color-highlight);
    margin-bottom: 0.5rem;
  }
  
  .form-subtitle {
    color: #94a3b8;
    font-size: 0.95rem;
  }
  
  .form-body {
    padding: 2rem;
  }
  
  .form-group {
    margin-bottom: 1.5rem;
  }
  
  .form-label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: var(--color-text);
  }
  
  .form-label svg {
    width: 18px;
    height: 18px;
    color: var(--color-highlight);
  }
  
  .form-input {
    width: 100%;
    padding: 0.875rem;
    background: var(--color-input-bg);
    border: 2px solid transparent;
    border-radius: 0.5rem;
    color: var(--color-text);
    font-size: 1rem;
    transition: all 0.2s;
  }
  
  .form-input:focus {
    outline: none;
    border-color: var(--color-highlight);
    background: rgba(255, 255, 255, 0.1);
  }
  
  .password-input-wrapper {
    position: relative;
  }
  
  .password-actions {
    position: absolute;
    right: 0.5rem;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    gap: 0.5rem;
  }
  
  .password-btn {
    padding: 0.375rem 0.75rem;
    font-size: 0.8rem;
    background: var(--color-highlight);
    color: #0F172A;
    border: none;
    border-radius: 0.375rem;
    cursor: pointer;
    transition: all 0.2s;
    font-weight: 600;
  }
  
  .password-btn:hover {
    background: var(--color-accent);
    transform: translateY(-1px);
  }
  
  .show-btn {
    background: transparent;
    color: var(--color-highlight);
    border: 1px solid var(--color-highlight);
    padding: 0.375rem;
  }
  
  .show-btn:hover {
    background: var(--color-highlight);
    color: #0F172A;
  }
  
  .form-select {
    width: 100%;
    padding: 0.875rem;
    background: var(--color-input-bg);
    border: 2px solid transparent;
    border-radius: 0.5rem;
    color: var(--color-text);
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.2s;
  }
  
  .form-select:focus {
    outline: none;
    border-color: var(--color-highlight);
  }
  
  .form-textarea {
    width: 100%;
    padding: 0.875rem;
    background: var(--color-input-bg);
    border: 2px solid transparent;
    border-radius: 0.5rem;
    color: var(--color-text);
    font-size: 1rem;
    resize: vertical;
    min-height: 100px;
    max-height: 200px;
    transition: all 0.2s;
  }
  
  .form-textarea:focus {
    outline: none;
    border-color: var(--color-highlight);
    background: rgba(255, 255, 255, 0.1);
  }
  
  .form-actions {
    display: flex;
    gap: 1rem;
    margin-top: 2rem;
  }
  
  .btn {
    flex: 1;
    padding: 0.875rem 1.5rem;
    border-radius: 0.5rem;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
    text-decoration: none;
  }
  
  .btn-primary {
    background: var(--color-highlight);
    color: #0F172A;
    border: none;
  }
  
  .btn-primary:hover {
    background: #fbbf24;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3);
  }
  
  .btn-secondary {
    background: transparent;
    color: var(--color-text);
    border: 2px solid rgba(255, 255, 255, 0.2);
  }
  
  .btn-secondary:hover {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.3);
  }
  
  .required {
    color: #ef4444;
  }
  
  .form-hint {
    font-size: 0.85rem;
    color: #94a3b8;
    margin-top: 0.25rem;
  }
  
  .password-strength {
    display: flex;
    gap: 0.25rem;
    margin-top: 0.5rem;
    height: 4px;
  }
  
  .strength-bar {
    flex: 1;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 2px;
    transition: background 0.3s;
  }
  
  .strength-bar.active {
    background: var(--color-highlight);
  }
  
  .strength-bar.weak {
    background: #ef4444;
  }
  
  .strength-bar.medium {
    background: #f59e0b;
  }
  
  .strength-bar.strong {
    background: #10b981;
  }
</style>

<div class="entry-form-container">
  <div class="entry-form-card">
    <div class="form-header">
      <img src="{{ url_for('static', filename='img/logo.png') }}"
           alt="LockBox Logo"
           style="width: 80px; height: auto; margin-bottom: 1rem;" />
      <h1 class="form-title">Add New Entry</h1>
      <p class="form-subtitle">Securely store your password information</p>
    </div>
    
    <form action="{{ url_for('add_entry') }}" method="post" class="form-body">
      <div class="form-group">
        <label class="form-label">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
          </svg>
          Title <span class="required">*</span>
        </label>
        <input type="text" 
               id="title" 
               name="title" 
               class="form-input"
               placeholder="e.g., Gmail Account, Netflix, Banking App" 
               required 
               autofocus>
        <p class="form-hint">A memorable name to identify this entry</p>
      </div>

      <div class="form-group">
        <label class="form-label">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg>
          Username <span class="required">*</span>
        </label>
        <input type="text" 
               id="username" 
               name="username" 
               class="form-input"
               placeholder="your.email@example.com or username" 
               required>
      </div>

      <div class="form-group">
        <label class="form-label">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"></path>
          </svg>
          Password <span class="required">*</span>
        </label>
        <div class="password-input-wrapper">
          <input type="password" 
                 id="password" 
                 name="password" 
                 class="form-input"
                 style="padding-right: 7rem;"
                 placeholder="Enter your secure password" 
                 required
                 oninput="checkPasswordStrength(this.value)">
          <div class="password-actions">
            <button type="button" 
                    class="password-btn show-btn"
                    onclick="togglePasswordVisibility()"
                    title="Show/Hide password">
              <svg id="eye-icon" width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
              </svg>
            </button>
            <button type="button" 
                    class="password-btn"
                    onclick="generatePassword()">
              Generate
            </button>
          </div>
        </div>
        <div class="password-strength" id="password-strength">
          <div class="strength-bar" id="strength-1"></div>
          <div class="strength-bar" id="strength-2"></div>
          <div class="strength-bar" id="strength-3"></div>
          <div class="strength-bar" id="strength-4"></div>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
          </svg>
          URL
        </label>
        <input type="url" 
               id="url" 
               name="url" 
               class="form-input"
               placeholder="https://example.com">
        <p class="form-hint">Website URL for quick access</p>
      </div>

      <div class="form-group">
        <label class="form-label">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path>
          </svg>
          Folder
        </label>
        <select id="folder" name="folder_id" class="form-select">
          <option value="">No Folder (Unorganized)</option>
          {% for folder in folders %}
            <option value="{{ folder.id }}" {% if default_folder_id and folder.id == default_folder_id %}selected{% endif %}>
              {{ folder.name }}
            </option>
          {% endfor %}
        </select>
      </div>

      <div class="form-group">
        <label class="form-label">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
          </svg>
          Notes
        </label>
        <textarea id="notes" 
                  name="notes" 
                  class="form-textarea"
                  placeholder="Any additional information like security questions, account numbers, etc."></textarea>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-primary">
          <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20" style="display: inline-block; margin-right: 0.5rem;">
            <path d="M7.707 10.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V6h5a2 2 0 012 2v7a2 2 0 01-2 2H4a2 2 0 01-2-2V8a2 2 0 012-2h5v5.586l-1.293-1.293zM9 4a1 1 0 012 0v2H9V4z"></path>
          </svg>
          Save Entry
        </button>
        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">
          Cancel
        </a>
      </div>
    </form>
  </div>
</div>

<script>
function togglePasswordVisibility() {
  const passwordInput = document.getElementById('password');
  const eyeIcon = document.getElementById('eye-icon');
  
  if (passwordInput.type === 'password') {
    passwordInput.type = 'text';
    eyeIcon.innerHTML = `
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"></path>
    `;
  } else {
    passwordInput.type = 'password';
    eyeIcon.innerHTML = `
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
    `;
  }
}

async function generatePassword() {
  try {
    const response = await fetch('/generate-password');
    const data = await response.json();
    
    const passwordInput = document.getElementById('password');
    passwordInput.value = data.password;
    passwordInput.type = 'text'; // Show the generated password
    
    // Update password strength indicator
    checkPasswordStrength(data.password);
    
    // Visual feedback
    passwordInput.style.background = 'rgba(16, 185, 129, 0.1)';
    setTimeout(() => {
      passwordInput.style.background = '';
    }, 500);
    
  } catch (error) {
    console.error('Failed to generate password:', error);
    // Fallback to client-side generation
    const charset = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+-=[]{}|;:,.<>?';
    let password = '';
    for (let i = 0; i < 16; i++) {
      password += charset.charAt(Math.floor(Math.random() * charset.length));
    }
    document.getElementById('password').value = password;
    checkPasswordStrength(password);
  }
}

function checkPasswordStrength(password) {
  const bars = document.querySelectorAll('.strength-bar');
  let strength = 0;
  
  // Reset all bars
  bars.forEach(bar => {
    bar.classList.remove('active', 'weak', 'medium', 'strong');
  });
  
  if (password.length === 0) return;
  
  // Check password criteria
  if (password.length >= 8) strength++;
  if (password.length >= 12) strength++;
  if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
  if (/\d/.test(password)) strength++;
  if (/[!@#$%^&*(),.?":{}|<>]/.test(password)) strength++;
  
  // Map strength to visual indicator
  let activeCount = Math.min(Math.ceil(strength / 1.25), 4);
  let colorClass = 'weak';
  
  if (strength >= 4) colorClass = 'strong';
  else if (strength >= 2) colorClass = 'medium';
  
  // Activate bars
  for (let i = 0; i < activeCount; i++) {
    bars[i].classList.add('active', colorClass);
  }
}

// Auto-resize textarea
document.getElementById('notes').addEventListener('input', function() {
  this.style.height = 'auto';
  this.style.height = Math.min(this.scrollHeight, 200) + 'px';
});
</script>
{% endblock %}